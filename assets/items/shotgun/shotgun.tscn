[gd_scene load_steps=20 format=3 uid="uid://dxupji4311jnn"]

[ext_resource type="Script" path="res://assets/scripts/gun.gd" id="1_afh7n"]
[ext_resource type="Texture2D" uid="uid://iktfsw8pcf7m" path="res://assets/textures/items/r870.png" id="2_l8nuv"]
[ext_resource type="ArrayMesh" uid="uid://b8e085tqe0sa0" path="res://assets/models/R870.obj" id="3_g447q"]
[ext_resource type="Texture2D" uid="uid://b20xb0f2pshwy" path="res://assets/textures/muzzleflash.png" id="4_awj64"]
[ext_resource type="ArrayMesh" uid="uid://dd6ju4uco2g6" path="res://assets/models/MuzzleFlash.obj" id="5_44clt"]

[sub_resource type="Shader" id="Shader_wv8x0"]
code = "// NOTE: Shader automatically converted from Godot Engine 4.1.1.stable's StandardMaterial3D.

shader_type spatial;
render_mode blend_mix,depth_draw_opaque,cull_back,diffuse_burley,specular_schlick_ggx;
uniform float fov : hint_range(20, 120) = 40;
uniform vec4 albedo : source_color;
uniform sampler2D texture_albedo : source_color,filter_nearest,repeat_enable;
uniform float point_size : hint_range(0,128);
uniform float roughness : hint_range(0,1);
uniform sampler2D texture_metallic : hint_default_white,filter_nearest,repeat_enable;
uniform vec4 metallic_texture_channel;
uniform sampler2D texture_roughness : hint_roughness_r,filter_nearest,repeat_enable;
uniform float specular;
uniform float metallic;
uniform vec3 uv1_scale;
uniform vec3 uv1_offset;
uniform vec3 uv2_scale;
uniform vec3 uv2_offset;


void vertex() {
	float scale = 1.0 / tan(fov * 0.5 * PI / 180.0); 
    PROJECTION_MATRIX[0][0] = (1.0 / tan(fov * 0.5 * PI / 100.0)) / (VIEWPORT_SIZE.x / VIEWPORT_SIZE.y);
	UV=UV*uv1_scale.xy+uv1_offset.xy;
}






void fragment() {
	DEPTH = FRAGCOORD.z * 0.7;
	vec2 base_uv = UV;
	vec4 albedo_tex = texture(texture_albedo,base_uv);
	ALBEDO = albedo.rgb * albedo_tex.rgb;
	float metallic_tex = dot(texture(texture_metallic,base_uv),metallic_texture_channel);
	METALLIC = metallic_tex * metallic;
	vec4 roughness_texture_channel = vec4(1.0,0.0,0.0,0.0);
	float roughness_tex = dot(texture(texture_roughness,base_uv),roughness_texture_channel);
	ROUGHNESS = roughness_tex * roughness;
	SPECULAR = specular;
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_4cvpv"]
render_priority = 0
shader = SubResource("Shader_wv8x0")
shader_parameter/fov = 40.0
shader_parameter/albedo = Color(1, 1, 1, 1)
shader_parameter/point_size = 1.0
shader_parameter/roughness = 1.0
shader_parameter/metallic_texture_channel = null
shader_parameter/specular = 0.5
shader_parameter/metallic = 0.0
shader_parameter/uv1_scale = Vector3(1, 1, 1)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/uv2_scale = Vector3(1, 1, 1)
shader_parameter/uv2_offset = Vector3(0, 0, 0)
shader_parameter/texture_albedo = ExtResource("2_l8nuv")

[sub_resource type="Shader" id="Shader_tmrt1"]
code = "// NOTE: Shader automatically converted from Godot Engine 4.1.2.stable.mono's StandardMaterial3D.

shader_type spatial;
render_mode blend_mix,depth_draw_opaque,cull_disabled,diffuse_burley,specular_schlick_ggx;
uniform float fov : hint_range(20, 120) = 40;
uniform vec4 albedo : source_color;
uniform sampler2D texture_albedo : source_color,filter_nearest,repeat_enable;
uniform float point_size : hint_range(0,128);
uniform float roughness : hint_range(0,1);
uniform sampler2D texture_metallic : hint_default_white,filter_linear_mipmap,repeat_enable;
uniform vec4 metallic_texture_channel;
uniform sampler2D texture_roughness : hint_roughness_r,filter_linear_mipmap,repeat_enable;
uniform float specular;
uniform float metallic;
uniform sampler2D texture_emission : source_color, hint_default_black,filter_linear_mipmap,repeat_enable;
uniform vec4 emission : source_color;
uniform float emission_energy;
uniform vec3 uv1_scale;
uniform vec3 uv1_offset;
uniform vec3 uv2_scale;
uniform vec3 uv2_offset;


void vertex() {
	float scale = 1.0 / tan(fov * 0.5 * PI / 180.0); 
    PROJECTION_MATRIX[0][0] = (1.0 / tan(fov * 0.5 * PI / 100.0)) / (VIEWPORT_SIZE.x / VIEWPORT_SIZE.y);
	UV=UV*uv1_scale.xy+uv1_offset.xy;
}






void fragment() {
	DEPTH = FRAGCOORD.z * 0.7;
	vec2 base_uv = UV;
	vec4 albedo_tex = texture(texture_albedo,base_uv);
	ALBEDO = albedo.rgb * albedo_tex.rgb;
	float metallic_tex = dot(texture(texture_metallic,base_uv),metallic_texture_channel);
	METALLIC = metallic_tex * metallic;
	vec4 roughness_texture_channel = vec4(1.0,0.0,0.0,0.0);
	float roughness_tex = dot(texture(texture_roughness,base_uv),roughness_texture_channel);
	ROUGHNESS = roughness_tex * roughness;
	SPECULAR = specular;
	vec3 emission_tex = texture(texture_emission,base_uv).rgb;
	EMISSION = (emission.rgb+emission_tex)*emission_energy;
	ALPHA *= albedo.a * albedo_tex.a;
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_83128"]
render_priority = 0
shader = SubResource("Shader_tmrt1")
shader_parameter/fov = 42.0
shader_parameter/albedo = Color(1, 1, 1, 1)
shader_parameter/point_size = 1.0
shader_parameter/roughness = 1.0
shader_parameter/metallic_texture_channel = null
shader_parameter/specular = 0.5
shader_parameter/metallic = 0.0
shader_parameter/emission = Color(0, 0, 0, 1)
shader_parameter/emission_energy = 1.0
shader_parameter/uv1_scale = Vector3(1, 1, 1)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/uv2_scale = Vector3(1, 1, 1)
shader_parameter/uv2_offset = Vector3(0, 0, 0)
shader_parameter/texture_albedo = ExtResource("4_awj64")
shader_parameter/texture_emission = ExtResource("4_awj64")

[sub_resource type="Animation" id="Animation_2xr23"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("model:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0.246403, -0.6, -1.125)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("model:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(-0.000380647, -0.00871835, -0.0436316)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("model/muzzleflash:visible")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("model/muzzleflash:scale")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(1, 2, 2)]
}

[sub_resource type="Animation" id="Animation_vj8hy"]
resource_name = "ammocheck"
length = 1.5
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("model:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.4, 0.5, 0.7, 1.5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0.246403, -0.6, -1.125), Vector3(0.246403, -0.663446, -1.125), Vector3(0.26415, -0.651697, -0.967739), Vector3(0.203325, -0.651697, -0.967739), Vector3(0.246403, -0.6, -1.125)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("model:rotation")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.4, 0.5, 0.7, 1.1, 1.5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(-0.000380647, -0.00871835, -0.0436316), Vector3(0.235879, -0.00481814, 0.780504), Vector3(0.169446, 0.157094, 0.746817), Vector3(0.117347, 0.155906, 0.738512), Vector3(-0.0446019, 0.0152974, 0.0691787), Vector3(-0.000380647, -0.00871835, -0.0436316)]
}

[sub_resource type="Animation" id="Animation_7igrk"]
resource_name = "equip"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("model:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.3, 1),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector3(0.16727, -1.54917, 0.79413), Vector3(0.206836, -0.808616, -0.785716), Vector3(0.246403, -0.6, -1.125)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("model:rotation")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.3, 0.7, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [Vector3(-0.333887, 0.273756, -0.135298), Vector3(-0.395174, 0.39837, 1.05052), Vector3(0.089797, 0.130673, 0.142933), Vector3(-0.000380647, -0.00871835, -0.0436316)]
}

[sub_resource type="Animation" id="Animation_6okmq"]
resource_name = "idling"
length = 0.5
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("model:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 2, 4),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector3(0.246403, -0.6, -1.125), Vector3(0.246, -0.605, -1.125), Vector3(0.246403, -0.6, -1.125)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("model:rotation")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 2, 4),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector3(-0.000380647, -0.00871835, -0.0436316), Vector3(0, -0.00349066, -0.0436332), Vector3(-0.000380647, -0.00871835, -0.0436316)]
}

[sub_resource type="Animation" id="Animation_xi0v8"]
resource_name = "reload"
length = 3.4
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("model:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.4, 1, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2, 2.6, 2.7, 2.9, 3.4),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0.246403, -0.6, -1.125), Vector3(0.246403, -0.6, -0.828757), Vector3(0.246403, -0.6, -0.532513), Vector3(0.246403, -0.6, -0.524585), Vector3(0.246403, -0.6, -0.532513), Vector3(0.246403, -0.6, -0.524585), Vector3(0.246403, -0.6, -0.532513), Vector3(0.246403, -0.6, -0.524585), Vector3(0.246403, -0.6, -0.532513), Vector3(0.246403, -0.6, -0.524585), Vector3(0.246403, -0.6, -0.532513), Vector3(0.246403, -0.6, -0.524585), Vector3(0.246403, -0.6, -0.532513), Vector3(0.371883, -0.6, -0.125112), Vector3(0.489475, -0.6, -0.0657315), Vector3(0.371883, -0.6, -0.125112), Vector3(0.246403, -0.6, -1.125)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("model:rotation")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.4, 0.7, 1, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2, 2.6, 2.7, 2.9, 3.2, 3.4),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(-0.000380647, -0.00871835, -0.0436316), Vector3(-0.0539774, 0.751157, 1.20509), Vector3(0.382603, 1.33691, 1.66513), Vector3(0.710812, 1.36598, 1.52401), Vector3(0.706706, 1.42032, 1.49899), Vector3(0.710812, 1.36598, 1.52401), Vector3(0.706706, 1.42032, 1.49899), Vector3(0.710812, 1.36598, 1.52401), Vector3(0.706706, 1.42032, 1.49899), Vector3(0.710812, 1.36598, 1.52401), Vector3(0.706706, 1.42032, 1.49899), Vector3(0.710812, 1.36598, 1.52401), Vector3(0.706706, 1.42032, 1.49899), Vector3(0.710812, 1.36598, 1.52401), Vector3(0.0629062, 0.609598, -0.422373), Vector3(0.19651, 0.665413, -0.318265), Vector3(0.133149, 0.599596, -0.524421), Vector3(-0.187748, 0.180555, -0.274836), Vector3(-0.000380647, -0.00871835, -0.0436316)]
}

[sub_resource type="Animation" id="Animation_hrytk"]
resource_name = "run"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("model:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.5, 1),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector3(0.0137282, -0.779649, -0.733691), Vector3(0.0645255, -0.779649, -0.733691), Vector3(0.0137282, -0.779649, -0.733691)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("model:rotation")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.5, 1),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector3(-0.214443, 1.02305, 0.077647), Vector3(-0.278982, 1.12394, -0.0112397), Vector3(-0.214443, 1.02305, 0.077647)]
}

[sub_resource type="Animation" id="Animation_isic8"]
resource_name = "shoot"
length = 0.7
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("model:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [Vector3(0.246403, -0.6, -0.688408), Vector3(0.246403, -0.6, -0.782038), Vector3(0.193617, -0.574278, -0.983414), Vector3(0.246403, -0.6, -1.125)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("model:rotation")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0.0844566, -0.00874954, -0.0443731), Vector3(-0.0705014, -0.00488207, -0.0784071), Vector3(0.15373, -0.0403296, 0.566658), Vector3(-0.0310157, -0.0264948, -0.0518669), Vector3(-0.000380647, -0.00871835, -0.0436316)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("model/muzzleflash:visible")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.05),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [true, false]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("model/muzzleflash:scale")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0, 0.05),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Vector3(1, 2, 2), Vector3(2.3, 4.6, 4.6)]
}

[sub_resource type="Animation" id="Animation_lo2e0"]
resource_name = "shove"
step = 0.025
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("model:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.15, 0.275, 0.425, 0.7, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0.246403, -0.6, -1.125), Vector3(0.179035, -0.6, -1.04088), Vector3(0.0371786, -0.628419, -1.36399), Vector3(-0.205038, -0.658638, -1.5072), Vector3(0.279127, -0.6, -1.25869), Vector3(0.246403, -0.6, -1.125)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("model:rotation")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.15, 0.275, 0.425, 0.7, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(-0.000380647, -0.00871835, -0.0436316), Vector3(-0.137881, 3.06522, 1.81165), Vector3(-0.158604, 3.37162, 1.9513), Vector3(-0.195477, 3.08923, 1.83609), Vector3(0.236945, 0.42572, 1.17747), Vector3(-0.000380647, -0.00871835, -0.0436316)]
}

[sub_resource type="Animation" id="Animation_1efoj"]
resource_name = "unequip"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("model:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Vector3(0.246403, -0.6, -1.125), Vector3(0.246403, -0.793709, 0.302471)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("model:rotation")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 1),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Vector3(-0.000380647, -0.00871835, -0.0436316), Vector3(-1.10744, 1.83753, -0.344254)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_vpuhn"]
_data = {
"RESET": SubResource("Animation_2xr23"),
"ammocheck": SubResource("Animation_vj8hy"),
"equip": SubResource("Animation_7igrk"),
"idling": SubResource("Animation_6okmq"),
"reload": SubResource("Animation_xi0v8"),
"run": SubResource("Animation_hrytk"),
"shoot": SubResource("Animation_isic8"),
"shove": SubResource("Animation_lo2e0"),
"unequip": SubResource("Animation_1efoj")
}

[node name="shotgun" type="Node3D"]
script = ExtResource("1_afh7n")

[node name="model" type="MeshInstance3D" parent="."]
transform = Transform3D(0.449453, 0.0196372, -0.00392616, -0.0196236, 0.449765, 0.00017142, 0.00392606, -1.17921e-10, 0.450321, 0.246403, -0.6, -1.125)
layers = 1048575
material_override = SubResource("ShaderMaterial_4cvpv")
cast_shadow = 0
mesh = ExtResource("3_g447q")
skeleton = NodePath("../../../../../../../..")

[node name="muzzleflash" type="MeshInstance3D" parent="model"]
transform = Transform3D(0.999848, -0.0348986, 6.14224e-05, 0.0174493, 1.99969, -0.00152122, -1.74344e-05, 0.00152206, 2, -0.0128894, 0.410046, -4.49737)
visible = false
material_override = SubResource("ShaderMaterial_83128")
mesh = ExtResource("5_44clt")
skeleton = NodePath("../..")

[node name="light" type="OmniLight3D" parent="model/muzzleflash"]
transform = Transform3D(1, -1.76582e-18, -3.54924e-16, 1.76582e-18, 1, 6.66134e-17, 3.54924e-16, -6.66134e-17, 1, 0, 0, 0.0773988)
light_color = Color(1, 1, 0.490196, 1)
light_energy = 1.2
omni_range = 10.0

[node name="animplayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_vpuhn")
}

[node name="audioplayer" type="AudioStreamPlayer" parent="."]

[node name="timer" type="Timer" parent="."]
one_shot = true

[node name="maincam" type="Camera3D" parent="."]
fov = 80.0
